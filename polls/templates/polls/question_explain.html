{% extends 'polls/base.html' %}
{% load staticfiles %}
{% load static %}
{% load polls_tags %}
{% block body %}

    <link rel="stylesheet" type="text/css" href="https://codemirror.net/lib/codemirror.css"
          xmlns:right="http://www.w3.org/1999/xhtml">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" type="text/css" href="https://codemirror.net/theme/ambiance.css">
    <link rel="stylesheet" type="text/css" href="https://codemirror.net/theme/solarized.css">
    <link rel="stylesheet" type="text/css" href="https://codemirror.net/theme/monokai.css">
    <link rel="stylesheet" type="text/css" href="https://codemirror.net/theme/dracula.css">
    <link rel="stylesheet" type="text/css" href="https://codemirror.net/theme/cobalt.css">
    <link rel="stylesheet" type="text/css" href="https://codemirror.net/theme/eclipse.css">
    <link rel="stylesheet" type="text/css" href="https://codemirror.net/theme/elegant.css">
    <script type="text/javascript" src="{%  static 'CodeMirror/lib/codemirror.js' %}"></script>
    <script type="text/javascript" src="{%  static 'CodeMirror/mode/javascript/javascript.js' %}"></script>
    <script type="text/javascript" src="{%  static 'CodeMirror/mode/python/python.js' %}"></script>
    <script type="text/javascript" src="{%  static 'CodeMirror/mode/php/php.js' %}"></script>
    <script type="text/javascript" src="{%  static 'CodeMirror/mode/clike/clike.js' %}"></script>

    <script src="http://framework.jpillora.com/js/lib/require.js" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'editor.js' %}" type="text/javascript"></script>
    <script src="{% static 'base.js' %}" type="text/javascript"></script>

    <!--<script src="{#% static 'compiler.js' %#}" type="text/javascript"></script>-->


    <style>

        .container{
            background-color: whitesmoke;
            margin-top: 50px;
            width: auto;
            height: 55px;
            border: 1px solid lightgrey;

        }

        .row{
            margin-left: 65px;

        }


        .CodeMirror{
            /*
            right: 150px;
            margin-top: 0px;
            margin-right: 150px;
            margin-left: 150px;
            height: 600px;
            */
            border: 1px solid lightgrey;
            height: 400px;
            width: auto;
            margin-top: -22px;

        }



        #themeandlanguage{
            top: 10px;
            float: right;
            list-style: none;
            bottom: 10px;
        }


        #codeNav{
            width: auto;
        }

        /*
        .dropdown-toggle{
            position: absolute;
            margin-top: 5px;
            margin-bottom: 5px;
            left: 750px;
            width: 150px;
            height: 40px;

        }

        .glyphicon-triangle-bottom{
            left: 30px;
        }

        .dropdown-menu{
            left: 750px;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown a:hover {
            text-decoration: none;
        }

*/
        #output{
            visibility: hidden;
            background-color: white;
            margin-top: 25px;
        }

        #output #wrongAnswer{
            color: darkred;
            text-align: center;
        }

        #output #correctAnswer{
            color: darkgreen;
            text-align: center;
        }

        #output #answerText{
            text-align: center;
        }

        .show {display:block;}

    </style>

    <div class="row">

        <div class="col-sm-6">
            <div class="container" style="height: 455px; background-color: whitesmoke; overflow: scroll">

                <h1 id="question" class="text-success">{{ practice_question.question_area_name }}</h1>
                <p>{{ practice_question.author }} tarafından yazıldı.</p>


                <div class="container" style="height: auto; background-color: ghostwhite">
                    <p>{{ practice_question.question_area_text|safe }}</p>
                </div>

                <br>


                <div class="container" style="height: auto; background-color: ghostwhite">
                    <h4 style="font-weight: bold">Girdi Değerleri</h4>
                    <p>{{ practice_question.question_input_text }}</p>
                </div>

                <br>

                    {#% for input_item in practice_question.practice_question_input_set.all %#}

                        {#% if input_item.input_id == '1' %#}
                            <!--<p>input_item.input_text }}</p>-->
                        {#% endif %#}
                    {#% endfor %#}



                <div class="container" style="height: auto; background-color: ghostwhite">
                    <h4 style="font-weight: bold">Çıktı Değerleri</h4>
                    <p>{{ practice_question.question_answer_text }}</p>
                </div>


            </div>
        </div>



                {#% for input_item in practice_question.practice_question_input_set.all %#}
                 <!--   <textarea id="programInputField" name="inputField" class="container-fluid">{#  #}{ input_item.input_text }}</textarea>
                {#% endfor %#}
                <!--<textarea id="programInputField" class="container-fluid"></textarea>-->
                <!--<textarea id="storeInputField" style="display: none" class="container-fluid"></textarea>-->
                <!--<textarea id="falan">{#  #}{ user.userprofile.point }}</textarea>-->
                <!--<tr>
                <td><a href = "#">{#  #}{ practice_question.get_question_language_field_display }}</a> </td>
                </tr>-->


        <div class="col-sm-5">

                <div id="codeNav" class="container">

                        <ul>
                            <li class="dropdown" id="themeandlanguage">

                                <div class="btn-group" id="themeList">
                                    <button type="button" id="themeListButton" class="btn btn-default dropdown-toggle"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Tema
                                        <span class="glyphicon glyphicon-triangle-bottom"></span>
                                    </button>

                                    <ul class="dropdown-menu" id="themeList">

                                        <li><a id="themeMonokai">Monokai</a></li>

                                        <li><a id="themeCobalt">Eclipse</a></li>

                                    </ul>
                                </div>

                                <div class="btn-group" id="languageList">
                                    <button type="button" id="languageListButton" class="btn btn-default dropdown-toggle"
                                            data-toggle="dropdown" style="margin-bottom: 0px" aria-expanded="false">


                                        <span id="selectedLanguageArea" style="color:darkgreen">python</span>
                                        <span class="glyphicon glyphicon-triangle-bottom"></span>
                                    </button>

                                    <ul class="dropdown-menu" id="languageList">
                                        {% for language_item in practice_question.question_language_field.choices %}
                                            <li><a id="language">{{ language_item }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </div>

                             </li>

                        </ul>
                </div>


                <label for="template-html"></label>
                <textarea id="template-html" name="code" class="CodeMirror"></textarea>


                {% csrf_token %}
                <!--<input type="hidden" id="submitcodeurl" formmethod="post" formaction="{#% url "polls:submit_code" %#}"/>-->
                <input type='hidden' name='csrfmiddlewaretoken' value='{{ csrf_token }}' />


                <br>
                <!--
                <div class="submit">
                    <input id="submit" type="button" formaction="{#% url "polls:submit_code" %#}" formmethod="post" value="Gönder"/>
                </div>-->


                <button type="button" id="run" value="{% url "polls:run_code" %}" class="btn btn-group"
                        style="position:absolute; right: 15px">Çalıştır</button>
                <button type="button" id="submit" value="{% url "polls:submit_code" %}" class="btn btn-success"
                        style="position:absolute; right: 120px;">Gönder</button>


                <!--<button type="button" id="PythonCompile" class="btn btn-success" onclick  = "location.href =
                '{#% url 'polls:submit_code' %#}'" style="position: absolute; right: 100px; ">Gönder</button>-->

                <br>
                <br>


        </div>

        <div class="col-sm-11">
              <pre id="output"></pre>
        </div>

    </div>


    <br>


    <script type="text/javascript">


        var editor = CodeMirror.fromTextArea(document.getElementById('template-html'), {
                        lineNumbers: true,
                        mode: "python",
                        theme: "monokai",
                        indentWithTabs: true,
                        matchBrackets: true,
                        readOnly: false,
                    });

        /*editor.setSize(1096, 300);*/

        function submitCode() {

            var prog = editor.getValue();
            var resultArea = document.getElementById("output");

            resultArea.style.visibility = "visible";


            $.ajax({
                type: 'POST',
                url: $('#submit').val(),
                data: {
                    language: $('#selectedLanguageArea').text(),
                    code: prog,
                    question : {{ practice_question.id }}
                },

                success: submitSuccess,
                error: function(data) {
                    submitError(data);
                },

	        });


        }

        function submitSuccess(data, textstatus, jqXHR) {
            //console.log(data);

            //window.scrollTo(0,document.body.scrollHeight);
            $("html, body").animate({ scrollTop: $(document).height() }, "slow");


            var output = $('#output');
	        output.html('');
	        output.append('<p>' + data + '</p>');
        }


        $('#languageList').find('li').on('click', function(){

            $('#selectedLanguageArea').text($(this).text());


            if($(this).text() === 'c'){
                editor.setOption("mode", "text/x-csrc");
            }

            else if($(this).text() === 'c++'){
                editor.setOption("mode", "text/x-c++src");
            }

            else if($(this).text() === 'java') {
                editor.setOption("mode", "text/x-java");
                //editor.setText("public class Temp{" + '\n' + "public static void main(String[] args){" + '\n' + "}" + '\n' + "}");

            }
            else if($(this).text() === 'python'){
                editor.setOption("mode", "python");
            }

        });

        $('#themeList').find('li').on('click', function () {

            if($(this).text() === 'Monokai'){
                editor.setOption('theme', "monokai");
            }

            /*else if($(this).text() === 'Dracula'){
                editor.setOption('theme', "dracula");
            }

            else if($(this).text() === 'Cobalt'){
                editor.setOption('theme', "cobalt");
            }*/

            else if($(this).text() === 'Eclipse'){
                editor.setOption('theme', "eclipse");
            }

            /*
            else if($(this).text() === 'Elegant'){
                editor.setOption('theme', "elegant");
            }*/

        });


        function runCode() {

            var prog = editor.getValue();
            var resultArea = document.getElementById("output");
            resultArea.style.visibility = "visible";

            $.ajax({
                type: 'POST',
                url: $('#run').val(),
                data: {
                    language: $('#selectedLanguageArea').text(),
                    code: prog,
                    question : {{ practice_question.id }}
                },

                success: runSuccess,
                error: function(data) {
                    submitError(data);
                },

	        });

        }


        function runSuccess(data, textstatus, jqXHR) {
            //console.log(data);
            var output = $('#output');
	        output.html('');
	        output.append('<p>' + data + '</p>');
        }


        $(document).ready(function() {
	        $('#submit').click(submitCode);
	        $('#run').click(runCode);


	        //$('#languageList').change(editorLanguage);
	        //$('#language').click(selectLanguage);
            //$('input[type="radio"]').click(selectTheme);
	        //editor = decorateCodeMirror($('#language').val());
        });



        function decorateEditor(language) {
            var code, current, mode, codeEditor, configuration;
            var hlLine;

            $('.code').each(function() {
                current = this;
                mode = null;
                language = language.toLowerCase();
                if (language === 'c') {
                    mode = 'text/x-csrc';
                } else if (language === 'c++') {
                    mode = 'text/x-c++src';
                } else if (language === 'java') {
                    mode = 'text/x-java';
                } else if (language === 'python') {
                    mode = 'text/python';
                }

                configuration = {
                    lineNumbers: true,
                    matchBrackets: true,
                    readOnly: $(current).hasClass('readonly'),
                    tabMode: 'shift',
                    onCursorActivity: function() {
                        //codeEditor.setLineClass(hlLine, null);
                        //hlLine = codeEditor.setLineClass(codeEditor.getCursor().line, "activeline");
                    }
                };
                if (mode !== null) {
                    configuration.mode = mode;
                }
                codeEditor = CodeMirror.fromTextArea(this, configuration);
                hlLine = codeEditor.setLineClass(0, "activeline");
                /*
                var codeEditor = CodeMirror(
                    function(elt) {
                        current.parentNode.replaceChild(elt, current);
                    },
                    {
                        value: current.innerHTML.substring(1, current.innerHTML.length-1),
                        //mode: language,
                        lineNumbers: true,
                        readOnly: $(current).hasClass('readonly')
                    }
                );
                */
                if (!$(current).hasClass('readonly')) {
                    code = codeEditor;
                }
            });
            return code;
        }




        /*
        function dropFunction() {
            document.getElementById("dropdownId").classList.toggle("show");
        }

        window.onclick = function(event) {
            if (!event.target.matches('.dropbtn')) {

                var dropdowns = document.getElementsByClassName("dropdown-content");
                var i;
                for (i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
        */




        //function runCode() {
            /*
            var textareaList = document.getElementsByName("inputField");

            //for(var j = 0; j < textareaList.length; j++){
                runit($("#storeInputField").val());
                //runit(textareaList[j].innerHTML);
            //}
            */

        /*
        var btnShow = document.getElementById('PythonCompile').value;

        var inputLineSet = new Array();
        inputLineSet = document.getElementsByName("inputField");

        for(var j =0; j<inputLineSet.length; j++){

            btnShow.onclick = (function(opt) {
            return function() {
                runCode(opt);
            };
            })(inputLineSet[j]);
        }
        */



        /*
        function postData(input) {
            $.ajax({
                type: "POST",
                url: "program/derle",
                data: { param: input },
                success: callbackFunc
            });
        }

        function callbackFunc(response) {
            // do something with the response
            console.log(response);
        }

        postData('data to process');


        */



        /*


        */

    </script>


    <!--<iframe id="result"></iframe>-->

{% endblock %}
